## 类加载及执行子系统的案例与实战
### 一、概述
在Class文件格式与执行引擎这部分中，Class文件以何种格式存储，类型何时加载、如何连接以及虚拟机如何执行字节码指令等都是由虚拟机
直接控制行为，用户程序无法对其进行改变。能通过程序进行操作的，主要是**<font color=red>字节码生成与类加载器</font>**这两部分。

### 二、案例分析

#### 1、Tomcat:整体的类加载器架构
主流的java web服务器，如Tomcat、Jeety、WebLogic、WebSphere等都实现了自己定义的类加载器，因为他们需要解决一下问题：
* 1、部署在同一个服务器上的两个Web应用程序所使用的Java类库可以实现隔离（如不用应用程序依赖不同版本的第三方库）
* 2、部署在同一个服务器上的两个Web应用程序所使用的Java类库可以互相共享（如使用同一个Spring）
* 3、服务器需要尽可能保证自身的安全不受部署Web应用程序影响。
* 4、支持JSP应用的Web服务器大多需要支持HotSwap（热替换）功能，即JSP文件修改后无需重启

通过加装路径来解决上述问题

Tomcat目录结构中，有3组目录：/common/*、/server/* 、/shared/* 可以存放Java类库，web应用程序自身的目录/WEB-INF/*也可以；
* /common目录中：类库可以被Tomcat和所有web应用程序共同使用
* /server目录中：类库仅能被Tomcat使用
* /shared目录中：可以被所有Web应用程序使用，Tomcat自身不可见
* 放置在/WEBApp/WEB-INF目录中：仅可以被此Web应用程序使用       

Tomcat 6.x以后/common、/server、/shared合并为/lib目录

#### 2、OSGi：灵活的类加载器架构

OSGi：Open Service Gateway initiative 是由 OSGi联盟制订的一个基于Java语言的动态模块化规范

OSGi里，模块间的依赖关系从传统的上层模块依赖底层模块转变为平级模块之间的依赖，而且类库可见性控制精确，还可能实现模块级别热插拔。
上述功能都有因为OSGi可以灵活的类加载架构，OSGi 的模块类加载器之间只有规则，没有固定委派关系。
OSGi里面加载器之间的关系不再是双亲委派模型的树形结构，而是更为复杂的运行时才能确定的网状结构。


  

